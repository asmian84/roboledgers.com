<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AutoBookkeeping v3.0</title>
  <link rel="stylesheet" href="src/styles/styles.css">
</head>

<body>

  <!-- Sidebar Navigation -->
  <aside id="sidebar" class="sidebar">
    <div class="sidebar-header">
      <h1 class="logo">AutoBook<span>v3</span></h1>
      <button id="sidebar-close" class="sidebar-close" aria-label="Close sidebar">
        <span>âœ•</span>
      </button>
    </div>

    <nav class="sidebar-nav">
      <!-- Main Navigation -->
      <div class="nav-section">
        <a href="#/" class="nav-item active" data-route="/">
          <span class="nav-icon">ğŸ </span>
          <span class="nav-label">Home</span>
        </a>
        <a href="#/transactions" class="nav-item" data-route="/transactions">
          <span class="nav-icon">ğŸ’°</span>
          <span class="nav-label">Transactions</span>
        </a>
        <a href="#/vendors" class="nav-item" data-route="/vendors">
          <span class="nav-icon">ğŸ¢</span>
          <span class="nav-label">Vendors</span>
        </a>
        <a href="#/accounts" class="nav-item" data-route="/accounts">
          <span class="nav-icon">ğŸ“Š</span>
          <span class="nav-label">Accounts</span>
        </a>
        <a href="#/reports" class="nav-item" data-route="/reports">
          <span class="nav-icon">ğŸ“ˆ</span>
          <span class="nav-label">Reports</span>
        </a>
      </div>

      <!-- Admin Section -->
      <div class="nav-section">
        <div class="nav-section-label">Admin</div>
        <a href="#/team" class="nav-item" data-route="/team">
          <span class="nav-icon">ğŸ‘¥</span>
          <span class="nav-label">Team</span>
        </a>
        <a href="#/subscription" class="nav-item" data-route="/subscription">
          <span class="nav-icon">ğŸ’³</span>
          <span class="nav-label">Subscription</span>
        </a>
        <a href="#/audit" class="nav-item" data-route="/audit">
          <span class="nav-icon">ğŸ“‹</span>
          <span class="nav-label">Audit Log</span>
        </a>
      </div>
    </nav>

    <div class="sidebar-footer">
      <a href="#/settings" class="nav-item settings-item" data-route="/settings">
        <span class="nav-icon">âš™ï¸</span>
        <span class="nav-label">Settings</span>
      </a>
      <div class="user-info">
        <span class="user-avatar">ğŸ‘¤</span>
        <span class="user-name">User</span>
      </div>
    </div>
  </aside>

  <!-- Mobile Hamburger -->
  <button id="hamburger" class="hamburger" aria-label="Open menu">
    <span></span>
    <span></span>
    <span></span>
  </button>

  <!-- Main Content Area -->
  <main class="main-content">

    <!-- Breadcrumb Bar -->
    <div id="breadcrumb" class="breadcrumb">
      <a href="#/" class="breadcrumb-item">Home</a>
    </div>

    <!-- Page Content (Router injects here) -->
    <div id="app" class="app-container">
      <!-- Route content will be injected here -->
      <div class="page loading">
        <p>Loading...</p>
      </div>
    </div>

  </main>

  <!-- Auth Modal (only modal allowed) -->
  <div id="auth-modal" class="auth-modal" style="display: none;">
    <div class="auth-modal-content">
      <h2>Authentication Required</h2>
      <p>Please log in to continue.</p>
      <button class="btn-primary">Log In</button>
    </div>
  </div>

  <!-- Scripts -->
  <script src="src/core/state.js"></script>
  <script src="src/core/router.js"></script>
  <script src="src/core/breadcrumb.js"></script>

  <!-- Page Modules -->
  <script src="src/pages/home.js"></script>
  <script src="src/pages/transactions.js"></script>
  <script src="src/pages/vendors.js"></script>
  <script src="src/pages/vendorDetail.js"></script>
  <script src="src/pages/accounts.js"></script>
  <script src="src/pages/accountDetail.js"></script>
  <script src="src/pages/reports.js"></script>
  <script src="src/pages/settings.js"></script>

  <script>
    // Initialize application state
    const appState = createStore({
      currentUser: null,
      theme: 'light',
      sidebarOpen: false
    }, {
      storageKey: 'autobook_v3_state',
      persist: true
    });

    // Active nav updater
    function updateActiveNav(path) {
      const navItems = document.querySelectorAll('.nav-item');
      navItems.forEach(item => {
        const route = item.getAttribute('data-route');
        if (!route) return;

        // Exact match or starts with (for nested routes)
        if (route === path ||
          (path !== '/' && path.startsWith(route) && route !== '/')) {
          item.classList.add('active');
        } else {
          item.classList.remove('active');
        }
      });
    }

    // Update breadcrumb and nav on route change
    router.onChange((route) => {
      breadcrumbManager.update(route.path, route.params);
      updateActiveNav(route.path);
    });

    // Mobile sidebar toggle
    const hamburger = document.getElementById('hamburger');
    const sidebar = document.getElementById('sidebar');
    const sidebarClose = document.getElementById('sidebar-close');
    const mainContent = document.querySelector('.main-content');

    hamburger?.addEventListener('click', () => {
      sidebar.classList.add('open');
      appState.setState({ sidebarOpen: true });
    });

    sidebarClose?.addEventListener('click', () => {
      sidebar.classList.remove('open');
      appState.setState({ sidebarOpen: false });
    });

    // Close sidebar when clicking outside on mobile
    mainContent?.addEventListener('click', () => {
      if (window.innerWidth < 768 && sidebar.classList.contains('open')) {
        sidebar.classList.remove('open');
        appState.setState({ sidebarOpen: false });
      }
    });

    // ====================================
    // ROUTE REGISTRATION
    // ====================================

    // Home page renders inline for simplicity
    function renderHomePage() {
      return `
        <div class="page">
          <div class="page-header">
            <h1 class="page-title">Welcome to AutoBookkeeping v3.0</h1>
            <p class="page-subtitle">Your intelligent bookkeeping assistant</p>
          </div>

          <div class="dashboard-grid">
            <div class="card stat-card">
              <div class="stat-icon">ğŸ’°</div>
              <h3>Total Transactions</h3>
              <p class="stat-value">0</p>
              <a href="#/transactions" class="stat-link">View all â†’</a>
            </div>

            <div class="card stat-card">
              <div class="stat-icon">ğŸ¢</div>
              <h3>Vendors</h3>
              <p class="stat-value">0</p>
              <a href="#/vendors" class="stat-link">Manage â†’</a>
            </div>

            <div class="card stat-card">
              <div class="stat-icon">ğŸ“Š</div>
              <h3>Accounts</h3>
              <p class="stat-value">0</p>
              <a href="#/accounts" class="stat-link">View chart â†’</a>
            </div>

            <div class="card stat-card">
              <div class="stat-icon">ğŸ“ˆ</div>
              <h3>Reports</h3>
              <p class="stat-value">Ready</p>
              <a href="#/reports" class="stat-link">Generate â†’</a>
            </div>
          </div>

          <div class="card quick-actions">
            <h2>Quick Actions</h2>
            <div class="action-buttons">
              <button class="btn-primary">ğŸ“¥ Import Transactions</button>
              <button class="btn-secondary">â• Add Vendor</button>
              <button class="btn-secondary">ğŸ“‹ Create Rule</button>
            </div>
          </div>
        </div>
      `;
    }

    // Home/Dashboard
    router.register('/', () => {
      document.getElementById('app').innerHTML = renderHomePage();
    });

    router.register('/home', () => {
      document.getElementById('app').innerHTML = renderHomePage();
    });

    // Transactions
    router.register('/transactions', () => {
      document.getElementById('app').innerHTML = renderTransactions();
    });

    // Vendors List
    router.register('/vendors', () => {
      document.getElementById('app').innerHTML = renderVendors();
    });

    // Vendor Detail
    router.register('/vendors/:vendorId', (route) => {
      document.getElementById('app').innerHTML = renderVendorDetail(route.params);
    });

    // Accounts (Chart of Accounts)
    router.register('/accounts', () => {
      document.getElementById('app').innerHTML = renderAccounts();
    });

    // Account Detail
    router.register('/accounts/:accountId', (route) => {
      document.getElementById('app').innerHTML = renderAccountDetail(route.params);
    });

    // Reports
    router.register('/reports', () => {
      document.getElementById('app').innerHTML = renderReports();
    });

    // Settings routes
    router.register('/settings', () => {
      document.getElementById('app').innerHTML = renderSettings({ tab: 'general' });
    });

    router.register('/settings/appearance', () => {
      document.getElementById('app').innerHTML = renderSettings({ tab: 'appearance' });
    });

    router.register('/settings/data', () => {
      document.getElementById('app').innerHTML = renderSettings({ tab: 'data' });
    });

    router.register('/settings/subscription', () => {
      document.getElementById('app').innerHTML = renderSettings({ tab: 'subscription' });
    });

    router.register('/settings/about', () => {
      document.getElementById('app').innerHTML = renderSettings({ tab: 'about' });
    });

    // Admin routes
    router.register('/team', () => {
      document.getElementById('app').innerHTML = `
        <div class="page">
          <div class="page-header">
            <h1 class="page-title">Team Management</h1>
          </div>
          <div class="card">
            <p>Team management features coming soon</p>
          </div>
        </div>
      `;
    });

    router.register('/subscription', () => {
      document.getElementById('app').innerHTML = renderSettings({ tab: 'subscription' });
    });

    router.register('/audit', () => {
      document.getElementById('app').innerHTML = `
        <div class="page">
          <div class="page-header">
            <h1 class="page-title">Audit Log</h1>
          </div>
          <div class="card">
            <div class="grid-placeholder">
              <div class="placeholder-icon">ğŸ“‹</div>
              <p><strong>Audit log will be here</strong></p>
              <p>Track all user actions and system events</p>
            </div>
          </div>
        </div>
      `;
    });

    console.log('âœ… AutoBookkeeping v3.0 Navigation System initialized');
  </script>

</body>

</html>